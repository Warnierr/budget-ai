name: Preview Deployment Info

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  preview-info:
    name: Preview Info
    runs-on: ubuntu-latest
    
    steps:
      - name: Comment PR with preview info
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            const repoName = context.repo.repo;
            
            // Vercel genere automatiquement des previews pour les PRs
            const comment = `## ðŸš€ Preview Deployment
            
            Vercel deploiera automatiquement une preview de cette PR.
            
            **Checklist avant merge:**
            - [ ] Les tests CI passent (lint, typecheck, build)
            - [ ] La preview Vercel fonctionne correctement
            - [ ] Le code a ete review
            - [ ] Les changements sont documentes si necessaire
            
            ---
            *Ce commentaire est genere automatiquement.*`;
            
            // Verifie si un commentaire existe deja
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
            });
            
            const botComment = comments.find(c => 
              c.user.type === 'Bot' && c.body.includes('Preview Deployment')
            );
            
            if (!botComment) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                body: comment
              });
            }
